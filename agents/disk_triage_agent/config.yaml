name: Disk Triage Workflow
description: Disk usage triage that uses df/du output to decide cleanup guidance.

defaults:
  llm_provider: agx.llm.provider:OllamaProvider
  llm_params:
    model: llama3.2

agents:
  disk_triage_agent:
    description: "Detects disk pressure and highlights large directories."
    tools: [disk_usage_triage]
    self_deciding: true

tasks:
  - id: disk-path
    type: human_input
    agent: disk_triage_agent
    description: Provide the folder path to analyze.
    ui:
      title: Disk triage intake
      description: Enter a local folder path to analyze (df/du will run on this host).
      fields:
        - id: folder_path
          label: Folder path
          kind: path
          required: true

  - id: disk-usage-triage
    type: tool_run
    tool: disk_usage_triage
    agent: disk_triage_agent
    description: "Check disk usage and recommend cleanup targets based on df/du results."
    depends_on: [disk-path]
    input:
      path: "{{inputs.disk-path.folder_path}}"
      top_n: 5
      top_files: 10
      min_mb: 10
      timeout: 40

  - id: cleanup-recommendations
    agent: disk_triage_agent
    description: "Analyze disk usage output and recommend cleanup actions with rationale."
    depends_on: [disk-usage-triage]
    input:
      triage_output: "{{results.disk-usage-triage.output}}"
      criteria: "Prefer deleting caches, logs, build artifacts; avoid source repos unless explicitly flagged."
      output_format: |
        Return JSON only with this shape:
        {
          "summary": "...",
          "proposed_actions": [
            {"type": "delete", "path": "...", "size_mb": 123.4, "reason": "..."}
          ],
          "requires_confirmation": true
        }

  - id: approve-cleanup
    type: action_approval
    agent: disk_triage_agent
    description: "Approve proposed cleanup actions."
    depends_on: [cleanup-recommendations]
    source_task: cleanup-recommendations

tools:
  disk_usage_triage:
    type: agx.tools.builtin:DiskUsageTriageTool
