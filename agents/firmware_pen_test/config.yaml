name: firmware-penetration-workflow
description: Multi-phase agent orchestration for firmware reverse engineering and pentesting.
defaults:
  llm_provider: agentic.llm.provider:OllamaProvider
  llm_params:
    model: llama3.2
    host: http://localhost:11434

agents:
  firmware_agent:
    description: Executes the bare-metal/RTOS firmware workflow from intake to verification.
    tools:
      - firmware_intake
      - firmware_format_identifier
      - architecture_inference
      - firmware_section_extractor
      - firmware_static_analyzer
      - secret_scanner
      - weakness_profiler
      - verification_planner
    planning:
      max_iterations: 4

# Each task provides structured input that mirrors the workflow diagrams/cheat sheets.
tasks:
  - id: project-metadata
    type: human_input
    agent: firmware_agent
    description: Provide project metadata and firmware paths.
    ui:
      title: Firmware Intake
      description: Enter the local filesystem paths for the project doc and firmware image.
      fields:
        - id: project_doc
          label: Project doc path (Word/PDF)
          kind: path
          required: true
        - id: firmware_path
          label: Firmware image path
          kind: path
          required: true

  - id: consent
    type: human_approval
    agent: firmware_agent
    description: Confirm authorization to proceed with firmware analysis.
    reason: User consent required before running analysis tools.
    depends_on: [project-metadata]

  - id: intake
    agent: firmware_agent
    description: Decide decompression path and OS handling for the provided firmware image.
    depends_on: [consent]
    input:
      path: /path/to/firmware.bin  # replace with your firmware image path
      extract: true
      output_dir: ./artifacts/firmware_extract

  - id: format-identification
    agent: firmware_agent
    description: Identify firmware container via magic bytes.
    depends_on: [consent]
    input:
      path: /path/to/firmware.bin

  - id: architecture-deduction
    agent: firmware_agent
    description: Infer architecture/toolchain characteristics.
    depends_on: [consent]
    input:
      path: /path/to/firmware.bin

  - id: section-extraction
    agent: firmware_agent
    description: Summarize carved sections for tooling handoff.
    depends_on: [consent]
    input:
      path: /path/to/firmware.bin
      extract: false  # set true to carve with binwalk --dd

  - id: static-review
    agent: firmware_agent
    description: Perform configuration/component review.
    depends_on: [consent]
    input:
      path: /path/to/firmware.bin
      # Override patterns to hunt for specific services if needed.
      patterns: ["ssh", "telnet", "dropbear", "httpd", "ftp", "ota", "upgrade", "busybox", "openssl", "shadow", "passwd"]

  - id: secret-harvest
    agent: firmware_agent
    description: Scan for secrets/keys in carved blobs.
    depends_on: [consent]
    input:
      path: /path/to/firmware.bin

  - id: weakness-profile
    agent: firmware_agent
    description: Combine findings into a vulnerability profile.
    depends_on: [consent]
    input:
      path: /path/to/firmware.bin
      rtos: unknown
      crypto: unknown
      updater: unknown

  - id: verification-plan
    agent: firmware_agent
    description: Produce verification checklist for exploit/reporting phase.
    depends_on: [consent]
    input:
      findings:
        - Telnet exposed without auth
        - Unsigned bootloader updates
        - Hard-coded admin credentials

tools:
  firmware_intake:
    type: agentic.tools.builtin:FirmwareIntakeTool
  firmware_format_identifier:
    type: agentic.tools.builtin:FirmwareFormatIdentifierTool
  architecture_inference:
    type: agentic.tools.builtin:ArchitectureInferenceTool
  firmware_section_extractor:
    type: agentic.tools.builtin:FirmwareSectionExtractorTool
  firmware_static_analyzer:
    type: agentic.tools.builtin:FirmwareStaticAnalyzerTool
  secret_scanner:
    type: agentic.tools.builtin:SecretScannerTool
  weakness_profiler:
    type: agentic.tools.builtin:WeaknessProfilerTool
  verification_planner:
    type: agentic.tools.builtin:VerificationPlannerTool
